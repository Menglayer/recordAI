# 数据录入使用指南

## 🎯 概述

新版 `app.py` 专注于提供流畅、高效的数据录入体验，使用 Streamlit 的 `st.data_editor` 组件实现批量快照录入。

---

## 📸 功能区 A - 资产快照录入

### 功能特点

✅ **批量录入** - 使用动态表格一次性录入多个资产  
✅ **自动大写** - Symbol 自动转换为大写  
✅ **智能更新** - 相同日期、账户、资产的记录会自动更新  
✅ **实时验证** - 显示有效记录数量  
✅ **账户记忆** - 自动记住已使用的账户名称

### 使用步骤

#### 1. 选择日期和账户

```
📅 快照日期: 选择记录日期（默认为今天）
🏦 账户名称: 
  - 选择已有账户：从下拉菜单选择
  - 输入新账户：手动输入新的账户名称
```

**账户命名建议**:
- 交易所: `Binance`, `OKX`, `Bitget`, `Coinbase`
- 钱包: `Ledger`, `MetaMask`, `Trust Wallet`
- 券商: `IBKR`, `富途`, `老虎证券`

#### 2. 编辑持仓表格

**基本操作**:
- 点击单元格可以编辑
- 按 Tab 键移动到下一个单元格
- 按 Enter 确认输入
- 使用 `+` 按钮添加新行
- 使用 🗑️ 图标删除行

**示例数据**:

| Symbol | Quantity |
|--------|----------|
| BTC    | 0.5      |
| ETH    | 2.0      |
| SOL    | 50.0     |
| USDT   | 10000.0  |

**注意事项**:
- Symbol 会自动转为大写（输入 btc → 自动变为 BTC）
- 只有 Symbol 不为空且 Quantity > 0 的行才会被保存
- 支持最多 8 位小数精度

#### 3. 保存快照

- 点击 `💾 保存快照` 按钮
- 系统会显示成功保存的记录数
- 保存后表格会自动清空，准备下一次录入

#### 4. 清空表格（可选）

- 如果需要重新开始，点击 `🗑️ 清空表格` 按钮

---

## 💸 功能区 B - 资金进出录入

### 功能特点

✅ **简单表单** - 清晰的字段设计  
✅ **类型选择** - 入金/出金一键选择  
✅ **备注支持** - 可选的详细备注字段  
✅ **自动清空** - 提交后自动清空表单

### 使用步骤

#### 1. 填写基本信息

```
📅 日期: 选择转账日期
📋 类型: 
  - 💰 入金 (Deposit) - 从外部转入资金
  - 💸 出金 (Withdrawal) - 向外部转出资金
💵 金额 (USD): 输入金额（美元）
```

#### 2. 添加备注（可选）

```
📝 备注: 
  - 初始入金
  - 追加投资
  - 部分提现
  - 利润转出
  等等...
```

#### 3. 保存记录

- 点击 `💾 保存资金记录` 按钮
- 显示成功消息后，表单自动清空

---

## 📊 实际使用案例

### 案例 1: 记录交易所持仓快照

**场景**: 记录 Binance 交易所的加密货币持仓

```
日期: 2026-01-06
账户: Binance

持仓明细:
┌────────┬──────────┐
│ Symbol │ Quantity │
├────────┼──────────┤
│ BTC    │ 0.523    │
│ ETH    │ 3.456    │
│ SOL    │ 125.0    │
│ BNB    │ 10.5     │
│ USDT   │ 15000.0  │
└────────┴──────────┘
```

点击保存 → ✅ 成功保存 5 条快照记录！

### 案例 2: 记录多个账户

**今日盘点**:

1. **Binance 账户**
   - BTC: 0.523
   - ETH: 3.456
   - USDT: 15000

2. **OKX 账户**
   - BTC: 0.234
   - SOL: 200
   - USDT: 8000

3. **Ledger 冷钱包**
   - BTC: 1.0
   - ETH: 10.0

**操作流程**:
1. 选择账户 "Binance" → 输入持仓 → 保存
2. 切换账户 "OKX" → 输入持仓 → 保存
3. 切换账户 "Ledger" → 输入持仓 → 保存

### 案例 3: 记录资金进出

**入金记录**:
```
日期: 2026-01-01
类型: 💰 入金
金额: $10,000.00
备注: 初始投资资金
```

**出金记录**:
```
日期: 2026-01-05
类型: 💸 出金
金额: $2,000.00
备注: 部分利润取出
```

---

## 💡 最佳实践

### 1. 快照录入流程

**推荐频率**: 每天或每周一次

**标准流程**:
1. 打开所有交易所/钱包
2. 按账户顺序记录持仓
3. 记录完成后更新价格（使用价格服务）
4. 查看净值变化

### 2. 数据一致性

**命名规范**:
- ✅ 使用统一的账户名: `Binance`
- ❌ 避免不一致: `binance`, `Binance Exchange`, `BN`

**资产代码**:
- ✅ 使用标准代码: `BTC`, `ETH`, `USDT`
- ❌ 避免自定义: `Bitcoin`, `以太坊`

### 3. 快捷键技巧

- `Tab` - 移动到下一个单元格
- `Shift + Tab` - 移动到上一个单元格
- `Enter` - 确认并移到下一行
- 复制粘贴 - 从 Excel/Google Sheets 直接粘贴数据

### 4. 错误预防

**保存前检查**:
- ✅ Symbol 不为空
- ✅ Quantity > 0
- ✅ 账户名称正确
- ✅ 日期正确

---

## 🔍 常见问题

### Q1: 如何批量录入大量资产？

**A**: 有两种方法：

**方法 1: 在表格中逐行添加**
- 点击 `+` 按钮添加新行
- 逐个输入 Symbol 和 Quantity

**方法 2: 从 Excel 复制粘贴**
- 在 Excel 中准备数据（Symbol, Quantity）
- 选中并复制
- 在 data_editor 中粘贴（可能需要先删除默认行）

### Q2: 保存后发现数据错误怎么办？

**A**: 直接重新录入即可
- 相同日期、账户、资产的记录会自动更新
- 系统会用新数据覆盖旧数据

### Q3: Symbol 自动大写不生效？

**A**: 
- Symbol 在保存到数据库时会自动转为大写
- 显示可能有延迟，但保存时一定是大写

### Q4: 可以同时记录多个日期的快照吗？

**A**: 
- 一次只能选择一个日期
- 如需记录多个日期，请分次操作：
  1. 选择日期 A → 录入 → 保存
  2. 选择日期 B → 录入 → 保存

### Q5: 转账记录有什么用？

**A**: 
- 用于区分资产增长来源
- 计算真实收益率时会扣除外部资金影响
- 例如: 总资产从 $10,000 → $15,000
  - 如果有 $3,000 入金，真实收益 = $2,000 (20%)
  - 如果没有入金，真实收益 = $5,000 (50%)

---

## 🎨 界面设计亮点

### 1. 清晰的视觉层次
- 使用 emoji 图标增强识别度
- 分隔线明确区分功能区
- 统一的配色方案

### 2. 实时反馈
- 有效记录数量实时显示
- 成功保存后立即显示消息
- 气球动画庆祝成功

### 3. 智能交互
- 账户名称自动补全
- Symbol 自动大写
- 表单自动清空
- 数据自动更新

### 4. 侧边栏统计
- 实时显示数据库记录数
- 快速了解数据规模

---

## 📱 快捷操作

### 快速录入单个账户
```
1. 选择日期 → 今天
2. 选择账户 → Binance
3. 快速输入:
   BTC Tab 0.5 Enter
   ETH Tab 2.0 Enter
   USDT Tab 10000 Enter
4. 保存快照 → 完成！
```

### 快速记录入金
```
1. 滚动到资金进出区域
2. 日期 → 今天
3. 类型 → 入金
4. 金额 → 10000
5. 备注 → 初始投资
6. 保存 → 完成！
```

---

## 🔗 相关功能

完成数据录入后，你可以：

1. **📈 价格更新**: 前往"记录价格"页面，使用自动拉取功能批量更新价格
2. **📊 数据查看**: 在"数据查看"页面查看最近的记录
3. **💾 数据导出**: 导出数据为 CSV 格式进行备份

---

## 📄 版本信息

**版本**: v1.1.0  
**更新日期**: 2026-01-06  
**主要特性**: 
- st.data_editor 批量录入
- 智能账户管理
- 自动大写转换
- Upsert 数据保存

---

**提示**: 养成定期记录的习惯，可以帮助你更好地了解资产变化趋势！📊
